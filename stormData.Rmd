---
title: 'Impact of various weather events on property and health'
author: "Abdul Rasheed Narejo, CFA"
date: "August 27, 2018"
output:
  pdf_document:
  html_document:
    keep_md: true
    toc: true
    number_sections: true
    toc_depth: 2
    toc_float: true
    theme: flatly
    fig_width: 8
    fig_height: 6
---

## INTRODUCTION
Storms and other severe weather events can cause both public health and economic problems for communities and municipalities. Many severe events can result in fatalities, injuries, and property damage, and preventing such outcomes to the extent possible is a key concern.

This project involves exploring the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database. This database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage.

## DATA PROCESSING
### Loading required libraries

```{r echo = TRUE, message=FALSE, warning=FALSE}
library(data.table)
library(R.utils) # to unzip the bz2 format file
library(dplyr) # load dplyr for data manipulation
library(ggthemes) # use themes to beautify graphs
library(ggplot2) # ggplot for data visualization
```

### Loading the data

### Load the data (read.csv())
```{r echo = TRUE}
url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"

if (!file.exists("./data/stormData.csv")) {
    if (!file.exists("./data/stormData.csv.bz2")) {
        download.file(url, destfile = "./data/stormData.csv.bz2", 
              method = "curl",
              mode = "web")
        message("successfuly downloaded file")
    }
    bunzip2("stormData.csv.bz2", "./data/stormData.csv", remove = FALSE, skip = TRUE)
    message("Successfuly unzipped file")        
} else {
    message("file already exists!")    
}

```

```{r}
# stormData <- read.csv("./data/stormData.csv")
# save(stormData, file="./data/stormData.RData")
load("./data/stormData.RData")
names(stormData)
```
```{r}
humanCost <- stormData %>% group_by(EVTYPE) %>% summarize(totalFatalities = sum(FATALITIES), totalInjuries = sum(INJURIES), totalDamage = totalFatalities + totalInjuries) %>% arrange(desc(totalDamage)) %>% top_n(100)
unique(humanCost$EVTYPE)
```

```{r}
economicCost <- stormData %>% group_by(EVTYPE) %>% summarize(totalPropDamage = sum(PROPDMG), totalCropDamage = sum(CROPDMG), totalDamage = totalPropDamage + totalCropDamage) %>% arrange(desc(totalDamage)) %>% top_n(5)
head(economicCost)
```
